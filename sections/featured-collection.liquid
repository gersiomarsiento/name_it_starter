{%- assign alpineDataName = 'featuredCollectionSlider' | append: section.id | remove: '_' | remove: '-' -%}

<section
  class="w-full py-8 overflow-hidden color-{{ section.settings.color_scheme }} gradient"
  role="region"
  aria-label="{{ section.settings.heading }}"
  x-data="{{ alpineDataName }}"
>
  <div class="c-container flex flex-col gap-y-8">
    <div class="flex flex-col gap-y-5">
      {%- if section.settings.heading != blank -%}
        <h2 class="h2">{{ section.settings.heading }}</h2>
      {%- endif -%}

      {%- if section.settings.description -%}
        <div class="w-full richtext">{{ section.settings.description }}</div>
      {%- endif -%}
    </div>

    <div
      class="w-full relative desktop:overflow-hidden"
      x-ref="swiperContainer"
      x-cloak
    >
      <ul
        class="swiper-wrapper"
        role="list"
        aria-label="{{ 'general.slider.name' | t }}"
      >
        {%- for product in section.settings.collection.products limit: section.settings.products_to_show -%}
          <li class="swiper-slide !h-auto">
            {%- render 'card-product',
              product: product,
              show_secondary_image: section.settings.show_secondary_image,
              show_vendor: section.settings.show_vendor,
              quick_add: section.settings.quick_add
            -%}
          </li>
        {%- endfor -%}
      </ul>

      <button
        class="inset-center-y z-[1] left-3 h-8 w-8 bg-white rounded-full flex flex-col justify-center items-center shadow-lg"
        x-ref="swiperPrev"
        aria-label="Previous slide"
        aria-disabled="true"
      >
        {%- render 'icon-caret', class: 'w-4 rotate-90' -%}
      </button>

      <button
        class="inset-center-y z-[1] right-3 h-8 w-8 bg-white rounded-full flex flex-col justify-center items-center shadow-lg"
        x-ref="swiperNext"
        aria-label="Next slide"
      >
        {%- render 'icon-caret', class: 'w-4 -rotate-90' -%}
      </button>
    </div>

    <div class="w-full flex justify-center">
      <div
        class="max-w-max"
        x-ref="swiperPagination"
        style="
          --swiper-pagination-color: #000000;
          --swiper-pagination-bullet-inactive-color: #000000;
          --swiper-pagination-bullet-size: 12px;
        "
      ></div>
    </div>

    <div
      class="cursor-pointer w-full md:max-w-[290px] md:mx-auto"
      x-ref="swiperScrollbar"
    ></div>

    {%- if section.settings.cta_label != blank -%}
      <div class="flex justify-center">
        <a href="{{ section.settings.collection.url }}" class="button-primary">
          {{- section.settings.cta_label -}}
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  document.addEventListener(
    'alpine:init',
    () => {
      Alpine.data('{{ alpineDataName }}', () => ({
        init() {
          new Swiper(this.$refs.swiperContainer, {
            slidesPerView: 1.3,
            spaceBetween: 10,
            mousewheel: {
              forceToAxis: true,
            },
            freeMode: true,
            breakpoints: {
              580: {
                slidesPerView: 2.3,
                spaceBetween: 10,
              },
              768: {
                slidesPerView: 3.3,
                spaceBetween: 20,
              },
              1280: {
                slidesPerView: 3.8,
                spaceBetween: 20,
              },
              1441: {
                slidesPerView: 4,
                spaceBetween: 20,
              },
            },
            navigation: {
              prevEl: this.$refs.swiperPrev,
              nextEl: this.$refs.swiperNext,
            },
            pagination: {
              el: this.$refs.swiperPagination,
              clickable: true,
            },
            scrollbar: {
              el: this.$refs.swiperScrollbar,
              hide: false,
              draggable: true,
            },
          });
        },
      }));
    },
    { once: true }
  );
</script>

{% schema %}
{
  "name": "Featured collection",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "Featured collection",
      "label": "Heading"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 25,
      "step": 1,
      "default": 8,
      "label": "Maximum products to show"
    },
    {
      "type": "header",
      "content": "Call to Action"
    },
    {
      "type": "text",
      "id": "cta_label",
      "label": "Call to action label",
      "default": "View all"
    },
    {
      "type": "header",
      "content": "Product Card Settings"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "Show second image on hover"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show vendor"
    },
    {
      "type": "select",
      "id": "quick_add",
      "default": "none",
      "label": "Quick add",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "standard",
          "label": "Standard"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured collection"
    }
  ]
}
{% endschema %}
